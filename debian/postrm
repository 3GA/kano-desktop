#!/bin/bash

# postrm
#
# Copyright (C) 2013 Kano Computing Ltd.
# License:   http://www.gnu.org/licenses/gpl-2.0.txt GNU General Public License v2
#

openbox_rc=/etc/xdg/openbox/rc.xml
lxde_openbox_rc=/etc/xdg/openbox/LXDE/rc.xml

lightdm_greeter_config=/etc/lightdm/lightdm_gtk_greeter.conf
lightdm_config=/etc/lightdm/lightdm.conf

chromium_master_prefs=/etc/chromium/master_preferences
chromium_bookmarks=/etc/chromium/initial_bookmarks.html

lxde_autostart=/etc/xdg/lxsession/LXDE/autostart

case "$1" in
    remove|upgrade)

        # Remove squeak, but only from skel
        rm -rf /etc/skel/squeak

        # Revert old openbox config
        if [ -e "$openbox_rc-old" ]; then
            mv $openbox_rc-old $openbox_rc
        fi

        if [ -e "$lxde_openbox_rc-old" ]; then
            mv $lxde_openbox_rc-old $lxde_openbox_rc
        fi

        # Revert old lightdm greeter config
        if [ -e "$lightdm_greeter_config-old" ]; then
            mv $lightdm_greeter_config-old $lightdm_greeter_config
        fi

        # Don't isplay a list of user names when logging in
        sed -i 's/#\?\s*\(greeter-hide-users\=\).*/\1true/' "$lightdm_config"
        sed -i 's/#\?\s*\(user-session\=\).*/\1default/' "$lightdm_config"

        # Removing links
        rm -f /etc/skel/.config/pcmanfm
        rm -f /etc/skel/.config/lxpanel
        rm -f /etc/skel/.config/lxterminal
        rm -f /etc/skel/.config/lxsession
        rm -rf /etc/skel/Legal

        # Revert chromium config
        if [ -e "$chromium_bookmarks-old" ]; then
            mv $chromium_bookmarks-old $chromium_bookmarks
        fi
        if [ -e "$chromium_master_prefs-old" ]; then
            mv $chromium_master_prefs-old $chromium_master_prefs
        fi

        # Unset kdesk as the desktop manager
        if [ -e "$lxde_autostart-old" ]; then
            mv $lxde_autostart-old $lxde_autostart
        fi

        ;;
esac


#DEBHELPER#

exit 0
