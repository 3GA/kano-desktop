#!/bin/bash

# postrm
#
# Copyright (C) 2013 Kano Computing Ltd.
# License:   http://www.gnu.org/licenses/gpl-2.0.txt GNU General Public License v2
#

openbox_rc=/etc/xdg/openbox/rc.xml
lxde_openbox_rc=/etc/xdg/openbox/LXDE/rc.xml

lightdm_config=/etc/lightdm/lightdm.conf

chromium_master_prefs=/etc/chromium/master_preferences
chromium_bookmarks=/etc/chromium/initial_bookmarks.html

lxde_autostart=/etc/xdg/lxsession/LXDE/autostart

SUDOERS_FILE=/etc/sudoers.d/kano-desktop_conf

case "$1" in
    remove|upgrade)

        # Remove squeak, but only from skel
        rm -rf /etc/skel/squeak

        # Revert old openbox config
        if [ -e "$openbox_rc-old" ]; then
            mv $openbox_rc-old $openbox_rc
        fi

        if [ -e "$lxde_openbox_rc-old" ]; then
            mv $lxde_openbox_rc-old $lxde_openbox_rc
        fi

        # Revert to the default greeter
        sed -i 's/^\s*\(greeter-session\=\).*/\1lightdm-greeter/' "$lightdm_config"

        # Removing links
        rm -f /etc/skel/.config/pcmanfm
        rm -f /etc/skel/.config/libfm
        rm -f /etc/skel/.config/lxpanel
        rm -f /etc/skel/.config/lxterminal
        rm -f /etc/skel/.config/lxsession
        rm -rf /etc/skel/Legal
        rm -f /usr/bin/kano-greeter

        # Revert chromium config
        if [ -e "$chromium_bookmarks-old" ]; then
            mv $chromium_bookmarks-old $chromium_bookmarks
        fi
        if [ -e "$chromium_master_prefs-old" ]; then
            mv $chromium_master_prefs-old $chromium_master_prefs
        fi

        # Unset kdesk as the desktop manager
        if [ -e "$lxde_autostart-old" ]; then
            mv $lxde_autostart-old $lxde_autostart
        fi

        # remove sudoers file to switch VTs
        rm -f $SUDOERS_FILE

        ;;
esac


#DEBHELPER#

exit 0
